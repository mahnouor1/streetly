S<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Streetly Integration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link
      href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  </head>
  <body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold text-center mb-8">
        Streetly Integration Test
      </h1>

      <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Google Maps API Test</h2>
        <div id="map" class="w-full h-64 bg-gray-200 rounded-lg"></div>
        <button
          id="testMap"
          class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
        >
          Test Map Loading
        </button>
      </div>

      <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Places API Test</h2>
        <div class="flex space-x-4 mb-4">
          <input
            type="text"
            id="cityInput"
            placeholder="Enter city name"
            class="flex-1 border border-gray-300 rounded px-3 py-2"
          />
          <button
            id="testRestaurants"
            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
          >
            Test Restaurants
          </button>
          <button
            id="testAttractions"
            class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600"
          >
            Test Attractions
          </button>
        </div>
        <div id="results" class="mt-4"></div>
      </div>

      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-semibold mb-4">Chat API Test</h2>
        <div class="flex space-x-4 mb-4">
          <input
            type="text"
            id="chatInput"
            placeholder="Ask about restaurants, attractions..."
            class="flex-1 border border-gray-300 rounded px-3 py-2"
          />
          <button
            id="testChat"
            class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600"
          >
            Test Chat
          </button>
        </div>
        <div id="chatResults" class="mt-4 p-4 bg-gray-50 rounded"></div>
      </div>
    </div>

    <script src="js/api.js"></script>
    <script>
      const apiManager = new APIManager();

      document.getElementById("testMap").addEventListener("click", async () => {
        try {
          await apiManager.initializeMapLibre(document.getElementById("map"));
          document.getElementById("testMap").textContent =
            "Map Loaded Successfully!";
          document.getElementById("testMap").className =
            "mt-4 bg-green-500 text-white px-4 py-2 rounded";
        } catch (error) {
          console.error("Map test failed:", error);
          document.getElementById("testMap").textContent = "Map Test Failed";
          document.getElementById("testMap").className =
            "mt-4 bg-red-500 text-white px-4 py-2 rounded";
        }
      });

      document
        .getElementById("testRestaurants")
        .addEventListener("click", async () => {
          const city = document.getElementById("cityInput").value || "New York";
          try {
            const restaurants = await apiManager.searchRestaurants(city);
            displayResults(restaurants, "restaurants");
          } catch (error) {
            console.error("Restaurant test failed:", error);
            document.getElementById("results").innerHTML =
              '<p class="text-red-500">Restaurant search failed: ' +
              error.message +
              "</p>";
          }
        });

      document
        .getElementById("testAttractions")
        .addEventListener("click", async () => {
          const city = document.getElementById("cityInput").value || "New York";
          try {
            const attractions = await apiManager.searchAttractions(city);
            displayResults(attractions, "attractions");
          } catch (error) {
            console.error("Attraction test failed:", error);
            document.getElementById("results").innerHTML =
              '<p class="text-red-500">Attraction search failed: ' +
              error.message +
              "</p>";
          }
        });

      document
        .getElementById("testChat")
        .addEventListener("click", async () => {
          const message =
            document.getElementById("chatInput").value || "best restaurants";
          const city = document.getElementById("cityInput").value || "New York";
          try {
            const response = await apiManager.getEnhancedChatResponse(
              message,
              city
            );
            document.getElementById("chatResults").innerHTML =
              '<pre class="whitespace-pre-wrap">' + response + "</pre>";
          } catch (error) {
            console.error("Chat test failed:", error);
            document.getElementById("chatResults").innerHTML =
              '<p class="text-red-500">Chat test failed: ' +
              error.message +
              "</p>";
          }
        });

      function displayResults(items, type) {
        const resultsDiv = document.getElementById("results");
        if (items.length === 0) {
          resultsDiv.innerHTML =
            '<p class="text-gray-500">No ' + type + " found</p>";
          return;
        }

        let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
        items.slice(0, 6).forEach((item) => {
          html += `
                    <div class="border rounded p-4">
                        <h3 class="font-semibold">${item.name}</h3>
                        <p class="text-sm text-gray-600">${item.vicinity}</p>
                        <p class="text-sm">‚≠ê ${item.rating || "N/A"}</p>
                        ${
                          item.priceLevel > 0
                            ? '<p class="text-sm">üí∞ ' +
                              "$".repeat(item.priceLevel) +
                              "</p>"
                            : ""
                        }
                    </div>
                `;
        });
        html += "</div>";
        resultsDiv.innerHTML = html;
      }
    </script>
  </body>
</html>
